name: secure-rdp

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Ø¥Ø¹Ø¯Ø§Ø¯ RDP
      shell: powershell
      run: |
        Write-Host "ğŸ”§ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… RDP..."
        net user RDP RDP@2025 /add /y
        net localgroup administrators RDP /add
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        Write-Host "âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ RDP Ø¨Ù†Ø¬Ø§Ø­"

    - name: ØªØ«Ø¨ÙŠØª Tailscale ÙˆØ±Ø¨Ø·Ù‡
      shell: powershell
      run: |
        Write-Host "â¬‡ï¸ ØªØ«Ø¨ÙŠØª Tailscale..."
        iwr https://tailscale.com/install.ps1 -useb | iex
        tailscale up --authkey ${{ secrets.TAILSCALE_AUTHKEY }} --hostname "MyRDP" --accept-dns=false
        Write-Host "âœ… ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ù€ Tailscale Ø¨Ø§Ø³Ù… Ø«Ø§Ø¨Øª (MyRDP)"
        tailscale ip -4

    - name: Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„
      shell: powershell
      run: |
        Write-Host "ğŸ’¡ RDP Ø¬Ø§Ù‡Ø²! Ø§Ø³ØªØ®Ø¯Ù… Ctrl+C Ù„Ù„Ø¥ÙŠÙ‚Ø§Ù"
        Start-Sleep -Seconds 21600
