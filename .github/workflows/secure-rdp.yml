# --- 3. Robust Download Tailscale ---
          Write-Host "Downloading Tailscale MSI for amd64..."
          $msiPath = "C:\tailscale-setup.msi"
          # This is the correct, stable URL for the 64-bit Windows runner
          $downloadUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-amd64.msi"
          
          try {
            # Method 1: Start-BitsTransfer (Most reliable)
            Write-Host "Attempting download with Start-BitsTransfer..."
            Start-BitsTransfer -Source $downloadUrl -Destination $msiPath -ErrorAction Stop
            Write-Host "Download successful (BitsTransfer)."
          } catch {
            Write-Host "BitsTransfer failed: $_.Exception.Message"
            try {
              # Method 2: WebClient (Fallback)
              Write-Host "Attempting download with WebClient..."
              $webClient = New-Object System.Net.WebClient
              $webClient.DownloadFile($downloadUrl, $msiPath)
              Write-Host "Download successful (WebClient)."
            } catch {
              Write-Host "WebClient also failed: $_.Exception.Message. CRITICAL: Cannot download MSI."
              exit 1
            }
          }
